{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="row g-4">
  <div class="col-md-5">
    {% if product.image %}
      <img src="{{ product.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ product.title }}">
    {% else %}
      <img src="{% static 'img/placeholder.png' %}" class="img-fluid rounded shadow-sm" alt="{{ product.title }}">
    {% endif %}
  </div>
  <div class="col-md-7">
    <h2 class="h4">{{ product.title }}</h2>
    <div class="text-muted mb-2">Category: {{ product.category.name }}</div>
    <div class="fs-4 fw-bold mb-3">₹ {{ product.price }}</div>

    <form action="{% url 'add_to_cart' product.id %}" method="post" class="d-flex gap-2 mb-3">
      {% csrf_token %}
      <input type="number" class="form-control w-auto" name="qty" value="{{ in_cart_qty|default:1 }}" min="1">
      <button class="btn btn-primary">Add to Cart</button>
    </form>

    <div class="d-flex gap-2">
      <a href="{% url 'add_wishlist' product.id %}" class="btn btn-outline-secondary">Add to Wishlist</a>
      <a href="{% url 'checkout' %}" class="btn btn-success">Buy Now</a>
    </div>

    <hr class="my-4">
    <p>{{ product.description }}</p>
  </div>
</div>

<hr class="my-5">

<h3 class="h5">Ratings & Reviews</h3>
<div class="mb-3">
  {% for r in product.reviews.all %}
    <div class="border rounded p-3 mb-2 bg-white">
      <strong>{{ r.rating }}★</strong> by {{ r.user.username }}
      <div class="text-muted small">{{ r.created_at }}</div>
      <div>{{ r.comment }}</div>
    </div>
  {% empty %}
    <p>No reviews yet.</p>
  {% endfor %}
</div>

{% if user.is_authenticated %}
<form action="{% url 'add_review' product.slug %}" method="post" class="card card-body bg-white">
  {% csrf_token %}
  <div class="row g-2 align-items-center">
    <div class="col-auto">
      <label class="col-form-label">Rating</label>
    </div>
    <div class="col-auto">
      <select name="rating" class="form-select">
        <option>5</option><option>4</option><option>3</option><option>2</option><option>1</option>
      </select>
    </div>
    <div class="col">
      <input name="comment" class="form-control" placeholder="Write a review...">
    </div>
    <div class="col-auto">
      <button class="btn btn-primary">Submit</button>
    </div>
  </div>
</form>
{% else %}
<p><a href="{% url 'login' %}">Login</a> to add a review.</p>
{% endif %}

<hr class="my-5">
<h3 class="h5">You may also like</h3>
<div class="row g-3">
  {% for p in related %}
  <div class="col-6 col-md-3">
    <div class="card h-100 shadow-sm">
      <a href="{{ p.get_absolute_url }}">
        {% if p.image %}
          <img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.title }}">
        {% else %}
          <img src="{% static 'img/placeholder.png' %}" class="card-img-top" alt="{{ p.title }}">
        {% endif %}
      </a>
      <div class="card-body">
        <h6 class="card-title">{{ p.title|truncatechars:40 }}</h6>
        <p class="card-text">₹ {{ p.price }}</p>
      </div>
    </div>
  </div>
  {% empty %}
    <p>No related products found.</p>
  {% endfor %}
</div>
{% endblock %}
